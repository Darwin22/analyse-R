<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Facteurs et vecteurs labellisés</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<meta name="robots" content="index, follow">
<link rel="stylesheet" href="./include/analyse-R.css" />
<script type="text/javascript" src="./libs/zeroclipboard-2.2.0/ZeroClipboard.js"></script>
<link rel="stylesheet" href="./libs/colorbox-1.6.1/colorbox.css" />
<script type="text/javascript" src="./libs/colorbox-1.6.1/jquery.colorbox-min.js"></script>
<!--- favicon --->
<link rel="apple-touch-icon" sizes="57x57" href="./images/favicon/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="./images/favicon/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="./images/favicon/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="./images/favicon/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="./images/favicon/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="./images/favicon/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="./images/favicon/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="./images/favicon/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="./images/favicon/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="./images/favicon/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="./images/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="./images/favicon/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="./images/favicon/favicon-16x16.png">
<link rel="manifest" href="./images/favicon/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="./images/favicon/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="libs/navigation-1.0/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->





<nav>
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href=".">analyse-R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="manipuler" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Manipuler <span class="caret"></span></a>
          <ul class="dropdown-menu multi-column columns-3" role="menu" id="menu_manipuler">
            <div class="row">
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Prise en main</li>
                  <li><a href="presentation-et-philosophie.html">Présentation et Philosophie</a></li>
                  <li><a href="installation-de-R-et-RStudio.html">Installation de R et RStudio</a></li>
                  <li><a href="premier-contact.html">Premier contact</a></li>
                  <li><a href="premier-travail-avec-les-donnees.html">Premier travail avec des données</a></li>
                  <li><a href="extensions.html">Extensions</a></li>
                  <li><a href="vecteurs-indexation-et-assignation.html">Vecteurs, indexation et assignation</a></li>
                  <li><a href="listes-et-tableaux-de-donnes.html">Listes et Tableaux de données</a></li>
                  <li><a href="facteurs-et-vecteurs-labellises.html">Facteurs et vecteurs labellisés</a></li>
                  <li><a href="organiser-ses-fichiers.html">Organiser ses fichiers</a></li>
                  <li><a href="import-de-donnees.html">Import de données</a></li>
                  <li><a href="recodage.html">Recodage</a></li>
                  <li><a href="ou-trouver-de-l-aide.html">Où trouver de l'aide ?</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Manipulation de données</li>
                  <li class="dev"><a href="introduction-a-dplyr.html">Introduction à dplyr</a></li>
                  <li class="dev"><a href="introduction-a-data-table.html">Introduction à data.table</a></li>
                  <li class="dev"><a href="doublons.html">Doublons</a></li>
                  <li class="dev"><a href="tris.html">Tris</a></li>
                  <li class="dev"><a href="sous-ensembles.html">Sous-ensembles</a></li>
                  <li class="dev"><a href="fusion-de-tables.html">Fusion de tables</a></li>
                  <li class="dev"><a href="gestion-des-dates.html">Gestion des dates</a></li>
                  <li class="dev"><a href="aggregation.html">Aggrégation</a></li>
                  <li class="dev"><a href="fonctions-a-fenetre.html">Fonctions à fenêtre</a></li>
                  <li class="dev"><a href="restructuration-de-donnees.html">Restructuration de données</a></li>
                  <li class="dev"><a href="manipuler-du-texte.html">Manipuler du texte</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
                  <li class="dropdown-header">Exporter</li>
                  <li class="dev"><a href="export-de-donnees.html">Export de données</a></li>
                  <li><a href="export-de-graphiques.html">Export de graphiques</a></li>
                  <li class="dev"><a href="export-de-tableaux.html">Export de tableaux</a></li>
  	            </ul>
              </div>
            </div>
          </ul>
        </li>
        <li class="dropdown">
          <a href="analyser" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Analyser <span class="caret"></span></a>
          <ul class="dropdown-menu multi-column columns-3" role="menu" id="menu_analyser">
            <div class="row">
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Statistiques introductives</li>
                  <li><a href="statistique-univariee.html">Statistique univariée</a></li>
                  <li><a href="statistique-bivariee.html">Statistique bivariée</a></li>
                  <li><a href="intro-ggplot2.html">Introduction à ggplot2</a></li>
                  <li class="dev"><a href="graphiques-bivaries-ggplot2.html">Graphiques univariés et bivariés avec ggplot2</a></li>
                  <li><a href="donnees-ponderees.html">Données pondérées</a></li>
                  <li class="dev"><a href="graphiques-de-donnees-ponderees.html">Graphiques de données pondérées</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Statistiques intermédiaires</li>
  		            <li class="dev"><a href="intervalles-de-confiance.html">Intervalles de confiance</a></li>
                  <li class="dev"><a href="comparaisons-moyennes-et-proportions.html">Comparaisons (moyennes et proportions)</a></li>
                  <li><a href="definir-un-plan-d-echantillonnage-complexe.html">Définir un plan d'échantillonnage complexe</a></li>
                  <li class="dev"><a href="regression-lineaire.html">Régression linéaire</a></li>
                  <li><a href="regression-logistique.html">Régression logistique</a></li>
                  <li class="dev"><a href="analyse-en-composantes-principales.html">Analyse en composantes principales (ACP)</a></li>
                  <li><a href="analyse-des-correspondances-multiples.html">Analyse des correspondances multiples (ACM)</a></li>
                  <li><a href="classification-ascendante-hierarchique.html">Classification ascendante hiérarchique (CAH)</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
                  <li class="dropdown-header">Statistiques avancées</li>
                  <li class="dev"><a href="modeles-lineaires-a-effets-mixtes.html">Modèles linéaires à effets mixtes</a></li>
                  <li class="dev"><a href="modeles-gee.html">Modèles GEE</a></li>
                  <li class="dev"><a href="series-temporelles.html">Séries temporelles</a></li>
                  <li class="dev"><a href="modeles-a-temps-discret.html">Modèles à temps discret</a></li>
                  <li class="dev"><a href="analyse-de-survie.html">Analyse de survie</a></li>
                  <li><a href="analyse-de-sequences.html">Analyse de séquences</a></li>
                  <li class="dev"><a href="analyse-de-reseaux.html">Analyse de réseaux</a></li>
                  <li class="dev"><a href="analyse-spatiale.html">Analyse spatiale</a></li>
  	            </ul>
              </div>
            </div>
          </ul>
        </li>
        <li class="dropdown">
          <a href="approfondir" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Approfondir <span class="caret"></span></a>
          <ul class="dropdown-menu multi-column columns-3" role="menu" id="menu_approfondir">
            <div class="row">
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Graphiques</li>
                  <li class="dev"><a href="ggplot2-la-grammaire-des-graphiques.html">ggplot2 : la grammaire des graphiques</a></li>
                  <li class="dev"><a href="etendre-ggplot2.html">Étendre ggplot2</a></li>
                  <li class="dev"><a href="lattice-graphiques-et-formules.html">lattice : graphiques et formules</a></li>
                  <li class="dev"><a href="diagrammes.html">Diagrammes</a></li>
                  <li class="dev"><a href="representer-des-flux.html">Représenter des flux</a></li>
                  <li class="dev"><a href="reseaux-dynamiques.html">Réseaux dynamiques</a></li>
                  <li class="dev"><a href="ggvis-les-graphiques-interactifs.html">ggvis : les graphiques interactifs</a></li>
                  <li class="dev"><a href="htmlwidgets-la-puissance-du-javascript.html">htmlwidgets : la puissance de javascript</a></li>
                  <li class="dev"><a href="cartes.html">Cartes</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Programmation</li>
  		            <li class="dev"><a href="conditions-et-comparaisons.html">Conditions et comparaisons</a></li>
                  <li class="dev"><a href="formules.html">Formules</a></li>
                  <li class="dev"><a href="structures-conditionnelles.html">Structures conditionnelles</a></li>
                  <li class="dev"><a href="expressions-regulieres.html">Expressions régulières</a></li>
                  <li class="dev"><a href="ecrire-ses-propres-fonctions.html">Écrire ses propres fonctions</a></li>
                  <li class="dev"><a href="rmarkdown-les-rapports-automatises.html">R Markdown : les rapports automatisés</a></li>
                  <li class="dev"><a href="shiny-les-interfaces-interactives.html">Shiny : les interfaces interactives</a></li>
                  <li class="dev"><a href="git.html">Git</a></li>
                  <li class="dev"><a href="developper-un-package.html">Développer un package</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
                  <li class="dropdown-header">Divers</li>
                  <li><a href="calculer-un-age.html">Calculer un âge</a></li>
                  <li class="dev"><a href="prevR-cartes-de-prevalence.html">prevR : cartes de prévalence à partir des EDS</a></li>
  	            </ul>
              </div>
            </div>
          </ul>
        </li>
        <li class="dropdown">
          <a href="index" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Index <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="menu_naviguer">
            <li><a href="index-des-concepts.html">Index des concepts</a></li>
            <li><a href="index-des-fonctions.html">Index des fonctions</a></li>
            <li><a href="index-des-extensions.html">Index des extensions</a></li>
          </ul>
        </li>
        <li><a href="analyse-R.pdf">PDF</a></li>
      </ul>
    <form id="rechercher" class="navbar-form navbar-right" role="search" style="padding-top: 5px;" method="get" action="https://tontonroger.org/">
      <div class="form-group">
        <input name="q" type="text" class="form-control input-sm" placeholder="Rechercher">
      </div>
      <button type="submit" class="btn btn-default btn-sm" name="Rechercher">
        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
      </button>
    </form>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
</nav>

<div class="row">

<a href="https://github.com/larmarange/analyse-R"><img style="position: absolute; top: 60px; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Contribuer sur GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

<div class="col-sm-9" role="main">
<article>

<div class="fluid-row" id="header">


<h1 class="title">Facteurs et vecteurs labellisés</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#facteurs">Facteurs</a></li>
<li><a href="#labelled">Vecteurs labellisés</a><ul>
<li><a href="#les-etiquettes-de-variable">Les étiquettes de variable</a></li>
<li><a href="#les-etiquettes-de-valeur">Les étiquettes de valeur</a></li>
<li><a href="#assignation-et-condition">Assignation et condition</a></li>
<li><a href="#definir-des-valeurs-manquantes">Définir des valeurs manquantes</a></li>
<li><a href="#quelques-fonctions-supplementaires">Quelques fonctions supplémentaires</a></li>
</ul></li>
</ul>
</div>

<p>Dans le chapire sur les <a href="vecteurs-indexation-et-assignation.html">vecteurs</a>, nous avons abordé les types fondementaux de vecteurs (numériques, textuels, logiques). Mais il existe de nombreux autres classes de vecteurs afin de représenter des données diverses (comme les dates). Dans ce chapitre, nous nous intéressons plus particulièrement aux <dfn data-index="variable catégorielle">variables catégorielles</dfn><dfn data-index="catégorielle, variable"></dfn>.</p>
<p>Les <dfn data-index="facteur">facteurs</dfn> (ou <dfn data-index="factor" lang="en">factors</dfn> an anglais) sont un type de vecteur géré nativement par <strong>R</strong> et utilisés dans de nombreux domaines (modèles statistiques, représentations graphiques, …).</p>
<p>Les facteurs sont souvent mis en regard des <dfn data-index="donnée labelissée">données labellisées</dfn><dfn data-index="labellisée, donnée"></dfn><dfn data-index="labelled data"></dfn> telles qu’elles sont utilisées dans d’autres logiciels comme <strong>SPSS</strong> ou <strong>Stata</strong>. Or, les limites propres aux facteurs font qu’ils ne sont pas adpatés pour rendre compte des différents usages qui sont fait des données labellisées. Plusieurs extensions (telles que <code class="pkg">memisc</code> ou <code class="pkg">Hmisc</code>) ont proposé leur propre solution qui, bien qu’elles apportaient un plus pour la gestion des données labellisées, ne permettaient pas que celles-ci soient utilisées en dehors de ces extensions ou des extensions compatibles. Nous aborderons ici une nouvelle classe de vecteurs, la classe <code data-pkg="labelled">labelled</code>, introduite par l’extension <code class="pkg">haven</code> (que nous aborderons dans le cadre de l’<a href="import-de-donnees.html">import de données</a>) et qui peut être manipulée avec l’extension homonyme <code class="pkg">labelled</code>.</p>
<div id="facteurs" class="section level2">
<h2>Facteurs</h2>
<p>Dans ce qui suit on travaillera sur le jeu de données tiré de l’enquête <em>Histoire de vie</em>, fourni avec l’extension <code class="pkg">questionr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(questionr)
<span class="kw">data</span>(hdv2003)
d &lt;-<span class="st"> </span>hdv2003</code></pre></div>
<p>Jetons un il à la liste des variables de <code>d</code> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(d)</code></pre></div>
<pre><code>&#39;data.frame&#39;:   2000 obs. of  20 variables:
 $ id           : int  1 2 3 4 5 6 7 8 9 10 ...
 $ age          : int  28 23 59 34 71 35 60 47 20 28 ...
 $ sexe         : Factor w/ 2 levels &quot;Homme&quot;,&quot;Femme&quot;: 2 2 1 1 2 2 2 1 2 1 ...
 $ nivetud      : Factor w/ 8 levels &quot;N&#39;a jamais fait d&#39;etudes&quot;,..: 8 NA 3 8 3 6 3 6 NA 7 ...
 $ poids        : num  2634 9738 3994 5732 4329 ...
 $ occup        : Factor w/ 7 levels &quot;Exerce une profession&quot;,..: 1 3 1 1 4 1 6 1 3 1 ...
 $ qualif       : Factor w/ 7 levels &quot;Ouvrier specialise&quot;,..: 6 NA 3 3 6 6 2 2 NA 7 ...
 $ freres.soeurs: int  8 2 2 1 0 5 1 5 4 2 ...
 $ clso         : Factor w/ 3 levels &quot;Oui&quot;,&quot;Non&quot;,&quot;Ne sait pas&quot;: 1 1 2 2 1 2 1 2 1 2 ...
 $ relig        : Factor w/ 6 levels &quot;Pratiquant regulier&quot;,..: 4 4 4 3 1 4 3 4 3 2 ...
 $ trav.imp     : Factor w/ 4 levels &quot;Le plus important&quot;,..: 4 NA 2 3 NA 1 NA 4 NA 3 ...
 $ trav.satisf  : Factor w/ 3 levels &quot;Satisfaction&quot;,..: 2 NA 3 1 NA 3 NA 2 NA 1 ...
 $ hard.rock    : Factor w/ 2 levels &quot;Non&quot;,&quot;Oui&quot;: 1 1 1 1 1 1 1 1 1 1 ...
 $ lecture.bd   : Factor w/ 2 levels &quot;Non&quot;,&quot;Oui&quot;: 1 1 1 1 1 1 1 1 1 1 ...
 $ peche.chasse : Factor w/ 2 levels &quot;Non&quot;,&quot;Oui&quot;: 1 1 1 1 1 1 2 2 1 1 ...
 $ cuisine      : Factor w/ 2 levels &quot;Non&quot;,&quot;Oui&quot;: 2 1 1 2 1 1 2 2 1 1 ...
 $ bricol       : Factor w/ 2 levels &quot;Non&quot;,&quot;Oui&quot;: 1 1 1 2 1 1 1 2 1 1 ...
 $ cinema       : Factor w/ 2 levels &quot;Non&quot;,&quot;Oui&quot;: 1 2 1 2 1 2 1 1 2 2 ...
 $ sport        : Factor w/ 2 levels &quot;Non&quot;,&quot;Oui&quot;: 1 2 2 2 1 2 1 1 1 2 ...
 $ heures.tv    : num  0 1 0 2 3 2 2.9 1 2 2 ...</code></pre>
<p>Nous voyons que de nombreuses variables de ce tableau de données, telles que <var>sexe</var> ou <var>nivetud</var>, sont du type facteur.</p>
<p>Les facteurs prennent leurs valeurs dans un ensemble de modalités prédéfinies et ne peuvent en prendre d’autres. La liste des valeurs possibles est donnée par la fonction <code data-pkg="base">levels</code> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(d$sexe)</code></pre></div>
<pre><code>[1] &quot;Homme&quot; &quot;Femme&quot;</code></pre>
<p>Si on veut modifier la valeur du sexe du premier individu de notre tableau de données avec une valeur non autorisée, on obient un message d’erreur et une valeur manquante est utilisée à la place :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d$sexe[<span class="dv">1</span>] &lt;-<span class="st"> &quot;Chihuahua&quot;</span></code></pre></div>
<pre><code>Warning in `[&lt;-.factor`(`*tmp*`, 1, value =
structure(c(NA, 2L, 1L, 1L, : invalid factor
level, NA generated</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d$sexe[<span class="dv">1</span>]</code></pre></div>
<pre><code>[1] &lt;NA&gt;
Levels: Homme Femme</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d$sexe[<span class="dv">1</span>] &lt;-<span class="st"> &quot;Homme&quot;</span>
d$sexe[<span class="dv">1</span>]</code></pre></div>
<pre><code>[1] Homme
Levels: Homme Femme</code></pre>
<p>On peut très facilement créer un facteur à partir d’une variable textuelle avec la fonction <code data-pkg="base">factor</code> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;H&quot;</span>, <span class="st">&quot;H&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;H&quot;</span>))
v</code></pre></div>
<pre><code>[1] H H F H
Levels: F H</code></pre>
<p>Par défaut, les niveaux d’un facteur nouvellement créés sont l’ensemble des valeurs de la variable textuelle, ordonnées par ordre alphabétique. Cette ordre des niveaux est utilisé à chaque fois qu’on utilise des fonctions comme <code data-pkg="base">table</code>, par exemple :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(v)</code></pre></div>
<pre><code>v
F H 
1 3 </code></pre>
<p>On peut modifier cet ordre au moment de la création du facteur en utilisant l’option <code>levels</code> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;H&quot;</span>, <span class="st">&quot;H&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;H&quot;</span>), <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;H&quot;</span>, 
  <span class="st">&quot;F&quot;</span>))
<span class="kw">table</span>(v)</code></pre></div>
<pre><code>v
H F 
3 1 </code></pre>
<p>On peut aussi modifier l’ordre des niveaux d’une variable déjà existante :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d$qualif &lt;-<span class="st"> </span><span class="kw">factor</span>(d$qualif, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Ouvrier specialise&quot;</span>, 
  <span class="st">&quot;Ouvrier qualifie&quot;</span>, <span class="st">&quot;Employe&quot;</span>, <span class="st">&quot;Technicien&quot;</span>, <span class="st">&quot;Profession intermediaire&quot;</span>, 
  <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Autre&quot;</span>))
<span class="kw">table</span>(d$qualif)</code></pre></div>
<pre><code>
      Ouvrier specialise         Ouvrier qualifie 
                     203                      292 
                 Employe               Technicien 
                     594                       86 
Profession intermediaire                    Cadre 
                     160                      260 
                   Autre 
                      58 </code></pre>
<div class="note">
<p>L’extension <code class="pkg">questionr</code> propose une <em>interface interactive</em> pour le réordonnancement des niveaux d’un facteur. Cette fonction, nommée <code data-pkg="questionr">iorder</code>, vous permet de réordonner les modalités de manière graphique et de générer le code <strong>R</strong> correspondant.</p>
<p>Dans l’exemple précédant, si vous exécutez :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">iorder</span>(d, <span class="st">&quot;qualif&quot;</span>)</code></pre></div>
<p><strong>RStudio</strong> devrait ouvrir une fenêtre semblable à celle de la figure ci-dessous.</p>
<p><img src="images/capture_iorder.png" alt="Interface de la commande iorder" /></p>
<p>Vous pouvez alors déplacer les modalités par glisser-déposer, vérifier le résultat dans l’onglet <em>Vérification</em> et, une fois le résultat satisfaisant, récupérer le code généré pour l’inclure dans votre script.</p>
</div>
<p>On peut également modifier les niveaux eux-mêmes. Imaginons que l’on souhaite créer une nouvelle variable <em>qualif.abr</em> contenant les noms abrégés des catégories socioprofessionnelles de <em>qualif</em>. On peut alors procéder comme suit :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d$qualif.abr &lt;-<span class="st"> </span><span class="kw">factor</span>(d$qualif, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Ouvrier specialise&quot;</span>, 
  <span class="st">&quot;Ouvrier qualifie&quot;</span>, <span class="st">&quot;Employe&quot;</span>, <span class="st">&quot;Technicien&quot;</span>, <span class="st">&quot;Profession intermediaire&quot;</span>, 
  <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Autre&quot;</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;OS&quot;</span>, <span class="st">&quot;OQ&quot;</span>, <span class="st">&quot;Empl&quot;</span>, 
  <span class="st">&quot;Tech&quot;</span>, <span class="st">&quot;Interm&quot;</span>, <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Autre&quot;</span>))
<span class="kw">table</span>(d$qualif.abr)</code></pre></div>
<pre><code>
    OS     OQ   Empl   Tech Interm  Cadre  Autre 
   203    292    594     86    160    260     58 </code></pre>
<p>Dans ce qui précède, le paramètre <code>levels</code> de <code data-pkg="base">factor</code> permet de spécifier quels sont les niveaux retenus dans le facteur résultat, ainsi que leur ordre. Le paramètre <code>labels</code>, lui, permet de modifier les noms de ces niveaux dans le facteur résultat. Il est donc capital d’indiquer les noms de <code>labels</code> exactement dans le même ordre que les niveaux de <code>levels</code>. Pour s’assurer de ne pas avoir commis d’erreur, il est recommandé d’effectuer un tableau croisé entre l’ancien et le nouveau facteur :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$qualif, d$qualif.abr)</code></pre></div>
<pre><code>                          
                            OS  OQ Empl Tech
  Ouvrier specialise       203   0    0    0
  Ouvrier qualifie           0 292    0    0
  Employe                    0   0  594    0
  Technicien                 0   0    0   86
  Profession intermediaire   0   0    0    0
  Cadre                      0   0    0    0
  Autre                      0   0    0    0
                          
                           Interm Cadre Autre
  Ouvrier specialise            0     0     0
  Ouvrier qualifie              0     0     0
  Employe                       0     0     0
  Technicien                    0     0     0
  Profession intermediaire    160     0     0
  Cadre                         0   260     0
  Autre                         0     0    58</code></pre>
<p>On a donc ici un premier moyen d’effectuer un recodage des modalités d’une variable de type facteur. D’autres méthodes existent, que nous aborderons dans le chapitre <a href="recodage.html">Recodage</a>.</p>
<p>À noter que par défaut, les valeurs manquantes ne sont pas considérées comme un niveau de facteur. On peut cependant les transformer en niveau en utilisant la fonction <code data-pkg="base" data-rdoc="factor">addNA</code>. Ceci signifie cependant qu’elle ne seront plus considérées comme manquantes par <strong>R</strong> mais comme une modalité à part entière :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(d$trav.satisf)</code></pre></div>
<pre><code>  Satisfaction Insatisfaction      Equilibre 
           480            117            451 
          NA&#39;s 
           952 </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(<span class="kw">addNA</span>(d$trav.satisf))</code></pre></div>
<pre><code>  Satisfaction Insatisfaction      Equilibre 
           480            117            451 
          &lt;NA&gt; 
           952 </code></pre>
<p>La fonction <code data-pkg="questionr">addNAstr</code> de l’extension <code class="pkg">questionr</code> fait la même chose mais permet de spécifier l’étiquette de la modalité des valeurs manquantes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(questionr)
<span class="kw">summary</span>(<span class="kw">addNAstr</span>(d$trav.satisf, <span class="st">&quot;Manquant&quot;</span>))</code></pre></div>
<pre><code>  Satisfaction Insatisfaction      Equilibre 
           480            117            451 
      Manquant 
           952 </code></pre>
</div>
<div id="labelled" class="section level2">
<h2>Vecteurs labellisés</h2>
<p>Nous abordons ici une nouvelle classe de vecteurs, la classe <code data-pkg="labelled">labelled</code>, introduite récemment par l’extension <code class="pkg">haven</code> (que nous aborderons dans le cadre de l’<a href="import-de-donnees.html">import de données</a>) et qui peut être manipulée avec l’extension homonyme <code class="pkg">labelled</code>.</p>
<p>Pour cette section, nous allons utiliser d’autres données d’exemple, également disponibles dans l’extension <code class="pkg">questionr</code>. Il s’agit d’un ensemble de trois tableaux de données (<code>menages</code>, <code>femmes</code> et <code>enfants</code>) contenant les données d’une enquête de fécondité. Commençons par les charger en mémoire :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(questionr)
<span class="kw">data</span>(fecondite)</code></pre></div>
<p>Pour ailleurs, nous allons avoir besoin de l’extension <code class="pkg">labelled</code> qui permet de manipuler ces données labellisées.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(labelled)</code></pre></div>
<div id="les-etiquettes-de-variable" class="section level3">
<h3>Les étiquettes de variable</h3>
<p>Les <dfn data-index="étiquette de variable">étiquettes de variable</dfn><dfn data-index="variable, étiquette"></dfn> permettent de donner un nom long, plus explicite, aux différentes colonnes d’un tableau de données (ou encore directement à un vecteur autonome).</p>
<p>La visonneuse de données de <strong>RStudio</strong> sait reconnaître et afficher ces étiquettes de variable lorsqu’elles existent. Essayez par exemple la commande suivante :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(femmes)</code></pre></div>
<p>Les fonctions <code data-pkg="questionr">lookfor</code> et <code data-pkg="questionr">describe</code> de l’extension <code class="pkg">questionr</code> affichent également les étiquettes de variables lorsqu’elles existent.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lookfor</span>(femmes, <span class="st">&quot;rés&quot;</span>)</code></pre></div>
<pre><code>  variable               label
7   milieu Milieu de résidence
8   region Région de résidence</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">describe</span>(femmes$id_femme)</code></pre></div>
<pre><code>[2000 obs.] Identifiant de l&#39;enquêtée
integer: 391 1643 85 881 1981 ...
min: 1 - max: 2000 - NAs: 0 (0%) - 2000 unique values</code></pre>
<p>Pour manipuler les étiquettes de variable, il suffit d’utiliser la fonction <code data-pkg="labelled">var_label</code> de l’extension <code class="pkg">labelled</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">var_label</span>(femmes$id_menage)</code></pre></div>
<pre><code>[1] &quot;Identifiant du ménage&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">var_label</span>(femmes$id_menage) &lt;-<span class="st"> &quot;ID du ménage auquel elle appartient&quot;</span>
<span class="kw">var_label</span>(femmes$id_menage)</code></pre></div>
<pre><code>[1] &quot;ID du ménage auquel elle appartient&quot;</code></pre>
<p>On utilisera la valeur <code>NULL</code> pour supprimer une étiquette :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>)
<span class="kw">var_label</span>(v)</code></pre></div>
<pre><code>NULL</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">var_label</span>(v) &lt;-<span class="st"> &quot;Ma variable&quot;</span>
<span class="kw">var_label</span>(v)</code></pre></div>
<pre><code>[1] &quot;Ma variable&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">var_label</span>(v) &lt;-<span class="st"> </span><span class="ot">NULL</span>
<span class="kw">var_label</span>(v)</code></pre></div>
<pre><code>NULL</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">var_label</span>(v) &lt;-<span class="st"> &quot;Une autre étiquette&quot;</span>
<span class="kw">var_label</span>(v)</code></pre></div>
<pre><code>[1] &quot;Une autre étiquette&quot;</code></pre>
<p>Le fait d’ajouter une étiquette à un vecteur ne modifie en rien son type. Regardons la structure de notre objet <code>v</code> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(v)</code></pre></div>
<pre><code> atomic [1:5] 1 5 2 4 1
 - attr(*, &quot;label&quot;)= chr &quot;Une autre étiquette&quot;</code></pre>
<p>Que voit-on ? Notre vecteur possède maintenant ce qu’on appelle un <dfn>attribut</dfn>, c’est-à-dire une information supplémentaire qui lui est attachée. Un objet peut avoir plusieurs attributs. Ici, notre étiquette de variable est strocké dans un attribut nommé <code>&quot;label&quot;</code>. Cela ne modifie en rien sa nature. Il ne s’agit que d’information en plus. Toutes les fonctions ne tiennent pas compte des étiquettes de variable. Peu importe ! La présence d’un attribut ne les empêchera de fonctionner. De même, même si l’extension <code class="pkg">labelled</code> n’est pas installée sur votre machine, vous pourrez toujours manipuler vos données comme si de rien n’était.</p>
<p>On peut associer une étiquette de variable à n’importe quel type de variable, qu’elle soit numérique, textuelle, un facteur ou encore des dates.</p>
</div>
<div id="les-etiquettes-de-valeur" class="section level3">
<h3>Les étiquettes de valeur</h3>
<p>Les <dfn data-index="étiquette de valeur">étiquettes de valeur</dfn><dfn data-index="valeur, étiquette"></dfn> consistent à attribuer une étiquette textuelle à certaines valeurs d’un vecteur. Elles ne peuvent s’appliquer qu’aux vecteurs numériques ou textuels.</p>
<p>Lorsqu’un vecteur possède des étiquettes de valeur, sa classe change et devient <code data-pkg="labelled">labelled</code>. Regardons déjà quelques exemples. Tout d’abord, jetons un apercu au contenu de l’objet <code>femmes</code> grace à la fonction <code data-pkg="dplyr">glimpse</code> de l’extension <code class="pkg">dplyr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">glimpse</span>(femmes)</code></pre></div>
<pre><code>Observations: 2,000
Variables: 17
$ id_femme       (int) 391, 1643, 85, 881, 19...
$ id_menage      (int) 381, 1515, 85, 844, 17...
$ poids          (dbl) 1.803150, 1.803150, 1....
$ date_entretien (date) 2012-05-05, 2012-01-2...
$ date_naissance (date) 1997-03-07, 1982-01-0...
$ age            (dbl) 15, 30, 33, 43, 25, 18...
$ milieu         (lbll) 2, 2, 2, 2, 2, 2, 2, ...
$ region         (lbll) 4, 4, 4, 4, 4, 3, 3, ...
$ educ           (lbll) 0, 0, 0, 0, 1, 0, 0, ...
$ travail        (lbll) 1, 1, 0, 1, 1, 0, 1, ...
$ matri          (lbll) 0, 2, 2, 2, 1, 0, 1, ...
$ religion       (lbll) 1, 3, 2, 3, 2, 2, 3, ...
$ journal        (lbll) 0, 0, 0, 0, 0, 0, 0, ...
$ radio          (lbll) 0, 1, 1, 0, 0, 1, 1, ...
$ tv             (lbll) 0, 0, 0, 0, 0, 1, 0, ...
$ nb_enf_ideal   (lbll) 4, 4, 4, 4, 4, 5, 10,...
$ test           (lbll) 0, 9, 0, 0, 1, 0, 0, ...</code></pre>
<p>Il apparaît que la variable <var>region</region> est de type <code data-pkg="labelled">labelled</code>. On peut le confirmer avec <code data-pkg="base">class</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(femmes$region)</code></pre></div>
<pre><code>[1] &quot;labelled&quot;</code></pre>
<p>Regardons les premières valeurs prises par cette variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(femmes$region)</code></pre></div>
<pre><code>&lt;Labelled double&gt; 
[1] 4 4 4 4 4 3

Labels:
 value label is_na
     1  Nord FALSE
     2   Est FALSE
     3   Sud FALSE
     4 Ouest FALSE</code></pre>
<p>Nous voyons que quatre étiquettes de valeurs ont été associées à notre variable. Le code 1 correspond ainsi à la région <q>Nord</q>, le code 2 à la région <q>Est</q>, etc. Laissons de côté pour le moment la colonne <code>is_na</code> que nous aborderons dans une prochaine section.</p>
<p>La liste des étiquettes est également renvoyée par la fonction <code data-pkg="questionr">describe</code> de <code class="pkg">questionr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">describe</span>(femmes$region)</code></pre></div>
<pre><code>[2000 obs.] Région de résidence
labelled numeric: 4 4 4 4 4 ...
min: 1 - max: 4 - NAs: 0 (0%) - 4 unique values
4 value labels: [1] Nord [2] Est [3] Sud [4] Ouest</code></pre>
<p>L’extension <code class="pkg">labelled</code> fournit la fonction <code data-pkg="labelled">val_labels</code> qui renvoie la liste des étiquettes de valeurs d’une variable sous la forme d’un vecteur nommé et la fonction <code data-pkg="labelled" data-rdoc="val_labels">val_label</code> (notez l’absence de ‘s’) qui renvoie l’étiquette associée à une valeur particulière. S’il n’y a pas d’étiquette de valeur, ces fonctions renvoient <code>NULL</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">val_labels</span>(femmes$region)</code></pre></div>
<pre><code> Nord   Est   Sud Ouest 
    1     2     3     4 </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">val_label</span>(femmes$region, <span class="dv">2</span>)</code></pre></div>
<pre><code>[1] &quot;Est&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">val_label</span>(femmes$region, <span class="dv">6</span>)</code></pre></div>
<pre><code>NULL</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">val_labels</span>(femmes$age)</code></pre></div>
<pre><code>NULL</code></pre>
<p>Re-regardons d’un peu plus près les premières valeurs de notre variable <var>region</var>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(femmes$region)</code></pre></div>
<pre><code>&lt;Labelled double&gt; 
[1] 4 4 4 4 4 3

Labels:
 value label is_na
     1  Nord FALSE
     2   Est FALSE
     3   Sud FALSE
     4 Ouest FALSE</code></pre>
<p>On s’aperçoit qu’il s’agit de valeurs numériques. Et l’affichage indique que notre variable est plus précisément du type <code>labelled double</code>. Pour rappel, <code>double</code> est synonyme de <code>numeric</code>. Autrement dit, la classe <code data-pkg="labelled">labelled</code> ne modifie pas le type sous-jacent d’un vecteur, que l’on peut toujours obtenir avec la fonction <code data-pkg="base">typeof</code>. Nous pouvons également tester si notre variable est numérique avec la fonction <code data-pkg="base" data-rdoc="numeric">is.numeric</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">typeof</span>(femmes$region)</code></pre></div>
<pre><code>[1] &quot;double&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.numeric</span>(femmes$region)</code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>À la différence des facteurs, le type original d’une variable labellisée n’est pas modifié par la présence d’étiquettes de valeur. Ainsi, il reste possible de calculer une moyenne à partir de notre variable <var>region</var> (même si cela n’est pas pertinent ici d’un point de vue sémantique).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(femmes$region)</code></pre></div>
<pre><code>[1] 2.412</code></pre>
<p>Avec un vecteur, nous aurions eu un bon message d’erreur.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(d$nivetud)</code></pre></div>
<pre><code>Warning in mean.default(d$nivetud): argument is
not numeric or logical: returning NA</code></pre>
<pre><code>[1] NA</code></pre>
<p>Nous allons voir qu’il est aussi possible d’associer des étiquettes de valeurs à des vecteurs textuels. Créons tout d’abord un vecteur textuel qui nous servira d’exemple.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;h&quot;</span>)
v</code></pre></div>
<pre><code>[1] &quot;f&quot; &quot;f&quot; &quot;h&quot; &quot;f&quot; &quot;h&quot;</code></pre>
<p>Le plus facile pour lui associer des étiquettes de valeur est d’utiliser <code data-pkg="labelled" data-rdoc="val_labels">val_label</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">val_label</span>(v, <span class="st">&quot;f&quot;</span>) &lt;-<span class="st"> &quot;femmes&quot;</span>
<span class="kw">val_label</span>(v, <span class="st">&quot;h&quot;</span>) &lt;-<span class="st"> &quot;hommes&quot;</span>
v</code></pre></div>
<pre><code>&lt;Labelled character&gt; 
[1] &quot;f&quot; &quot;f&quot; &quot;h&quot; &quot;f&quot; &quot;h&quot;

Labels:
 value  label is_na
     f femmes FALSE
     h hommes FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">typeof</span>(v)</code></pre></div>
<pre><code>[1] &quot;character&quot;</code></pre>
<p>Notre vecteur <code>v</code> a automatiquement été transformé en un vecteur de la classe <code>labelled</code>. Mais son type sous-jacent est resté <code>&quot;character&quot;</code>. Par ailleurs, les données elle-même n’ont pas été modifiées et ont conservé leurs valeurs originales.</p>
<p>Il est également possible de définir/modifier/supprimer l’ensemble des étiquettes de valeur d’une variable avec <code data-pkg="labelled">val_labels</code> en lui assignant un vecteur nommé.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">val_labels</span>(v) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Homme =</span> <span class="st">&quot;h&quot;</span>, <span class="dt">Femme =</span> <span class="st">&quot;f&quot;</span>, <span class="st">`</span><span class="dt">Valeur indéterminée</span><span class="st">`</span> =<span class="st"> &quot;i&quot;</span>)
v</code></pre></div>
<pre><code>&lt;Labelled character&gt; 
[1] &quot;f&quot; &quot;f&quot; &quot;h&quot; &quot;f&quot; &quot;h&quot;

Labels:
 value               label is_na
     h               Homme FALSE
     f               Femme FALSE
     i Valeur indéterminée FALSE</code></pre>
<p>Comme précédemment, on utilisera <code>NULL</code> pour supprimer une ou toutes les étiquettes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">val_label</span>(v, <span class="st">&quot;i&quot;</span>) &lt;-<span class="st"> </span><span class="ot">NULL</span>
v</code></pre></div>
<pre><code>&lt;Labelled character&gt; 
[1] &quot;f&quot; &quot;f&quot; &quot;h&quot; &quot;f&quot; &quot;h&quot;

Labels:
 value label is_na
     h Homme FALSE
     f Femme FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">val_labels</span>(v) &lt;-<span class="st"> </span><span class="ot">NULL</span>
v</code></pre></div>
<pre><code>[1] &quot;f&quot; &quot;f&quot; &quot;h&quot; &quot;f&quot; &quot;h&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(v)</code></pre></div>
<pre><code>[1] &quot;character&quot;</code></pre>
<p>Si l’on supprime toutes les étiquettes de valeur, alors notre vecteur retrouve sa classe initiale.</p>
</div>
<div id="assignation-et-condition" class="section level3">
<h3>Assignation et condition</h3>
<p>Les étiquettes de valeur sont plus souples que les facteurs, en ce sens qu’il n’est pas obligatoire d’indiquer une étiquette pour chaque valeur prise par une variable. Alors qu’il n’est pas possible avec un facteur d’assigner une valeur qui n’a pas été préalablement définie comme une des modalités possibles du facteur, nous n’avons pas cette limite avec les vecteurs labellisés.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">femmes$region[<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="dv">5</span></code></pre></div>
<p>Important : quand on assigne une valeur à un facteur, on doit transmettre le texte correspondant à la modalité, alors que pour un vecteur labellisé on transmettra le code sous-jacent (pour rappel, les étiquettes de valeur ne sont qu’une information additionnelle).</p>
<p>De plus, nous avons vu que les données initiales n’étaient pas modifiées par l’ajout ou la suppression d’étiquettes de valeur, alors que pour les facteurs ce n’est pas vrai. Pour mieux comprendre, essayons la commande suivante :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unclass</span>(<span class="kw">factor</span>(v))</code></pre></div>
<pre><code>[1] 1 1 2 1 2
attr(,&quot;levels&quot;)
[1] &quot;f&quot; &quot;h&quot;</code></pre>
<p>Un facteur stocke de manière interne les valeurs sous la forme d’une suite d’entiers, démarrant toujours par 1, forcément consécutifs, et dont les valeurs dépendent de l’ordre des facteurs. Pour s’en rendre compte :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unclass</span>(<span class="kw">factor</span>(v, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;h&quot;</span>, <span class="st">&quot;f&quot;</span>)))</code></pre></div>
<pre><code>[1] 2 2 1 2 1
attr(,&quot;levels&quot;)
[1] &quot;h&quot; &quot;f&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unclass</span>(<span class="kw">factor</span>(v, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;f&quot;</span>, <span class="st">&quot;h&quot;</span>)))</code></pre></div>
<pre><code>[1] 1 1 2 1 2
attr(,&quot;levels&quot;)
[1] &quot;f&quot; &quot;h&quot;</code></pre>
<p>Ce qui importe pour un facteur ce sont les modalités de ce dernier tandis que pour un vecteur labellisé ce sont les valeurs du vecteur elles-mêmes. Cela reste vrai pour l’écriture de conditions.</p>
<p>Prenons un premier exemple avec un facteur :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">describe</span>(d$sexe)</code></pre></div>
<pre><code>[2000 obs.] 
nominal factor: &quot;Homme&quot; &quot;Femme&quot; &quot;Homme&quot; &quot;Homme&quot; &quot;Femme&quot; ...
2 levels: Homme | Femme
NAs: 0 (0%)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$sexe ==<span class="st"> &quot;Homme&quot;</span>)</code></pre></div>
<pre><code>
FALSE  TRUE 
 1100   900 </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$sexe ==<span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<pre><code>
FALSE 
 2000 </code></pre>
<p>La condition valide est celle utilisant <code>&quot;Homme&quot;</code> qui est la valeur de la modalité du facteur.</p>
<p>Et avec un vecteur labellisé ?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">describe</span>(femmes$milieu)</code></pre></div>
<pre><code>[2000 obs.] Milieu de résidence
labelled numeric: 2 2 2 2 2 ...
min: 1 - max: 2 - NAs: 0 (0%) - 2 unique values
2 value labels: [1] urbain [2] rural</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(femmes$milieu ==<span class="st"> &quot;urbain&quot;</span>)</code></pre></div>
<pre><code>
FALSE 
 2000 </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(femmes$milieu ==<span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<pre><code>
FALSE  TRUE 
 1088   912 </code></pre>
<p>Ici, pour être valide, la condition doit porter sur les valeurs de la variable elle-même et non sur les étiquette.</p>
</div>
<div id="definir-des-valeurs-manquantes" class="section level3">
<h3>Définir des valeurs manquantes</h3>
<p>Nous savons que sous <strong>R</strong> nous pouvons indiquer des valeurs manquantes avec <code>NA</code>. Or, dans le domaine des enquêtes, il arrive fréquemment que l’on ait besoin de pouvoir spécifier plusieurs types de valeurs manquantes. En effet, le fait que l’enquêté ne sache pas quoi répondre à une question n’est pas la même chose qu’un refus de répondre ou encore qu’un oubli de répondre (i.e. aucune case n’a été cochée sur le questionnaire papier). Il est alors fréquent dans ces enquêtes d’utiliser différents codes pour indiquer ces cas de figure. Les habitués de <strong>SPSS</strong> savent qu’il est possible dans ce logiciel d’indiquer quelles valeurs spécifiques doivent être considérées comme manquantes.</p>
<p>La fonction <code data-pkg="labelled">missing_val</code> de l’extension <code class="pkg">labelled</code> permet de spécifier quelles valeurs doivent être considérées comme manquantes. Prenons un exemple :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">9</span>)
<span class="kw">val_labels</span>(v) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">oui =</span> <span class="dv">1</span>, <span class="st">`</span><span class="dt">peut-être</span><span class="st">`</span> =<span class="st"> </span><span class="dv">2</span>, <span class="dt">non =</span> <span class="dv">3</span>, 
  <span class="st">`</span><span class="dt">ne sait pas</span><span class="st">`</span> =<span class="st"> </span><span class="dv">8</span>, <span class="dt">refus =</span> <span class="dv">9</span>)
v</code></pre></div>
<pre><code>&lt;Labelled double&gt; 
[1] 1 2 1 8 3 9

Labels:
 value       label is_na
     1         oui FALSE
     2   peut-être FALSE
     3         non FALSE
     8 ne sait pas FALSE
     9       refus FALSE</code></pre>
<p>À ce stade, aucune valeur manquante n’a encore été définie. Ce que l’on peut voir dans la colonne <code>is_na</code> qui ne contient que <code>FALSE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">missing_val</span>(v) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">9</span>)
v</code></pre></div>
<pre><code>&lt;Labelled double&gt; 
[1] 1 2 1 8 3 9

Labels:
 value       label is_na
     1         oui FALSE
     2   peut-être FALSE
     3         non FALSE
     8 ne sait pas  TRUE
     9       refus  TRUE</code></pre>
<p>Nous avons maintenant indiqué que 8 et 9 doivent être considérées comme manquantes. La classe <code data-pkg="labelled">labelled</code> impose qu’une valeur manquante ait une étiquette de valeur. Si l’on essaie d’attribuer une valeur manquante qui n’a pas d’étiquette, on obtient un message d’erreur.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">missing_val</span>(v) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)</code></pre></div>
<pre><code>Error: no value label found for 7, please specify `force`</code></pre>
<p>On peut indiquer avec l’argument <code>force</code> ce que l’on souhaite faire dans ces cas-là : <code>FALSE</code> si l’on souhaite ne pas tenir compte des valeurs manquantes qui n’ont pas d’étiquette (et ne seront donc pas considérées comme manquantes) ou <code>TRUE</code> pour créer automatiquement une étiquette à ces valeurs qui n’en ont pas encore une.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">missing_val</span>(v, <span class="dt">force =</span> <span class="ot">FALSE</span>) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)
v</code></pre></div>
<pre><code>&lt;Labelled double&gt; 
[1] 1 2 1 8 3 9

Labels:
 value       label is_na
     1         oui FALSE
     2   peut-être FALSE
     3         non FALSE
     8 ne sait pas  TRUE
     9       refus  TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">missing_val</span>(v, <span class="dt">force =</span> <span class="ot">TRUE</span>) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)
v</code></pre></div>
<pre><code>&lt;Labelled double&gt; 
[1] 1 2 1 8 3 9

Labels:
 value       label is_na
     1         oui FALSE
     2   peut-être FALSE
     3         non FALSE
     8 ne sait pas  TRUE
     9       refus  TRUE
     7           7  TRUE</code></pre>
<p>À cette étape, nous n’avons fait qu’indiquer que ces valeurs peuvent être considérées sémantiquement comme manquantes. Pour autant, elles sont toujours présentes dans notre vecteur et considérées statistiquement comme des valeurs valides par les fonctions de <strong>R</strong>.</p>
<p>Prenons un nouvel exemple :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">notes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">16</span>, <span class="dv">99</span>, <span class="dv">14</span>, <span class="dv">17</span>)
<span class="kw">val_label</span>(notes, <span class="dv">99</span>) &lt;-<span class="st"> &quot;absent le jour de l&#39;examen&quot;</span>
<span class="kw">missing_val</span>(notes) &lt;-<span class="st"> </span><span class="dv">99</span>
notes</code></pre></div>
<pre><code>&lt;Labelled double&gt; 
[1] 12 16 99 14 17

Labels:
 value                      label is_na
    99 absent le jour de l&#39;examen  TRUE</code></pre>
<p>Calculons la moyenne de la classe :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(notes)</code></pre></div>
<pre><code>Warning in mean.labelled(notes): x has self-
defined missing values and missing_to_na is not
specified</code></pre>
<pre><code>[1] 31.6</code></pre>
<p>Hmmm ! Ce résultat n’est certainement pas le bon. Cela vient de notre valeur 99. Elle a été prise en compte lors du calcul de notre moyenne. Lorsque l’on travaille avec des vecteurs labellisés, même si l’on a spécifié des valeurs manquantes, c’est à l’utilisateur de de dire explicitement si pour une analyse donnée ces valeurs spécifiées comme manquantes doivent être transformées en <code>NA</code>. Cela se fait à l’aide de la fonction <code data-pkg="labelled">missing_to_na</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="kw">missing_to_na</span>(notes), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>[1] 14.75</code></pre>
<p>La méthode <code data-pkg="labelled" data-rdoc="mean.labelled">mean</code> ayant été définie pour les vecturs labellisées dans l’extension <strong class="pkg">labelled</strong>, il est également possible de faire directement :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(notes, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">missing_to_na =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>[1] 14.75</code></pre>
<p>Cette fois-ci, notre valeur 99 a bien été exclue du calcul de la moyenne de la classe.</p>
</div>
<div id="quelques-fonctions-supplementaires" class="section level3">
<h3>Quelques fonctions supplémentaires</h3>
<p>L’extension <code class="pkg">labelled</code> fournit quelques fonctions supplémentaires qui peuvent s’avérer utiles :</p>
<ul>
<li><code data-pkg="labelled">labelled</code> pour créer directement des vecteurs labellisés ;</li>
<li><code data-pkg="labelled">nolabel_to_na</code> pour convertir les valeurs n’ayant pas d’étiquette en <code>NA</code> ;</li>
<li><code data-pkg="labelled">val_labels_to_na</code> qui, à l’inverse, converti les valeurs avec étiquette en <code>NA</code> ;</li>
<li><code data-pkg="labelled">sort_val_labels</code> pour trier l’ordre des étiquettes de valeurs.</li>
</ul>
<p>On pourra se réferrer à l’aide de chacune de ces fonctions.</p>
<p>L’<a href="import-de-donnees.html">import de données labellisées</a> et le <a href="recodage.html">recodage de variables</a> (dont la conversion d’un vecteur labellisé en facteur) seront quant à eux abordés dans les prochains chapitres.</p>
</div>
</div>

</article>
</div>

<div class="col-sm-3" role="complementary">
<nav class="hidden-print hidden-xs" id="nav_sidebar">
</nav>
</div>

</div>

<script>
// manage active state of menu based on current page
$(document).ready(function () {

    // active menu
    href = window.location.pathname;
    href = href.substr(href.lastIndexOf('/') + 1);
    if (href=='') href = 'index.html';
    $('a[href="' + href + '"]').parent().addClass('active');
    $('a[href="' + href + '"]').parent().parents('li').addClass('active');

    // élargir la page d'accueil
    if (href=='index.html') $('.col-sm-9').attr('class','col-sm-12');

    // rechercher
    $("#rechercher").submit(function(event) {
      $('input[name="q"]').val($('input[name="q"]').val() + ' site:larmarange.github.io/analyse-R');
    });

    // sidebar
    $("#nav_sidebar").append($("#TOC").html());
    $("#nav_sidebar ul").addClass("nav nav-stacked");
    $("#TOC").addClass("visible-xs-block");
    $('body').scrollspy({
      target: '#nav_sidebar',
      offset: 40
    });

    // Identifier les <pre> fermant
    $('pre').next("*:not(pre)").prev().addClass('last'); // Dernier <pre> de chaque groupe contigu de <pre>
    $('pre').parent().each(function (){
      $(this).children('pre').last().addClass('last');
    }); // Si <pre> est le dernier enfant de son parent

    // Ajout liens rdocumentation et tooltip
    $("code[data-pkg]").each(function( index ) {
      pkg = $(this).attr('data-pkg');
      if ($(this).attr('data-rdoc') !== undefined) {
        rdocumentation = $(this).attr('data-rdoc');
      } else {
        rdocumentation = $(this).text();
      }
      fonction = $(this).text();
      $(this).wrap('<a href="http://www.rdocumentation.org/packages/'+pkg+'/functions/'+rdocumentation+'">');
      $(this).attr('data-toggle','tooltip');
      $(this).attr('data-placement','top');
      $(this).attr('title','package : ' + pkg);
      $('[data-toggle="tooltip"]').tooltip();
    });

    $("code.pkg").each(function( index ) {
      $(this).wrap('<a href="http://www.rdocumentation.org/packages/'+$(this).text()+'">');
    });

    // Figures
    $("figure").each(function( index ) {
      if ($(this).children("figcaption").length > 0)
        $(this).children("figcaption:first").prepend('<span class="figure-number">Figure '+(index+1)+'.</span> ');
      else
        $(this).append($("<figcaption>").append('<span class="figure-number">Figure '+(index+1)+'</span>'));
    });

    // Colorbox
    jQuery('article div img').colorbox({
      maxWidth: '90%',
      maxHeight: '90%',
      rel: 'figures',
      current: "",
      href: function(){
        return $(this).attr('src');
      },
      title: function(){
        return $(this).attr('alt');
      }
    });
    jQuery('article div img').css('cursor', 'pointer');
    jQuery('figure img').colorbox({
      maxWidth: '90%',
      maxHeight: '90%',
      rel: 'figures',
      current: "",
      href: function(){
        return $(this).attr('src');
      },
      title: function(){
        return $(this).parent().children("figcaption").text();
      }
    });
    jQuery('figure img').css('cursor', 'pointer');

    // ZeroClipboard
    $('pre.r').parent().each(function(){
      $(this).children('pre.r').first().before('<div class="zero-clipboard hidden-print hidden-xs"><button class="btn-clipboard">Copier</button></div>');
    }); // Il peut arriver que le pre ne soit pas précédé (cf. figures)
    $('*:not(pre):not(.zero-clipboard) + pre.r').before('<div class="zero-clipboard hidden-print hidden-xs"><button class="btn-clipboard">Copier</button></div>');
    $('pre.last').after(function() {
      if ($(this).hasClass("r")) res = $(this).text(); else res = "";
      $(this).prevUntil('*:not(pre)','pre.r').each(function() {
        res = $(this).text() + '\n' + res;
      });
      return '<div class="clipboard">' + res + '</div>';
    });
    $('.zero-clipboard').each(function(index){
      $(this).children('.btn-clipboard').attr('data-clipboard-target','clipboard_'+index);
      $(this).nextAll("div.clipboard").first().attr('id','clipboard_'+index);
    });
    var client = new ZeroClipboard( $(".btn-clipboard") );
    client.on( "ready", function( readyEvent ) {
      // alert( "ZeroClipboard SWF is ready!" );
      client.on( "aftercopy", function( event ) {
        // `this` === `client`
        // `event.target` === the element that was clicked
        //event.target.style.display = "none";
        $(event.target).parent().before('<div class="alert alert-success"><a href="#" class="close" data-dismiss="alert">&times;</a>Le code <strong>R</strong> de l’exemple a été copié dans le presse-papier.</div>');
      } );
    } );

});
</script>

<!-- disqus -->
<div class="row">
  <div id="disqus_thread" class="col-sm-9" role="complementary"></div>
</div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'analyse-r'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Veuillez activer JavaScript pour voir les <a href="http://disqus.com/?ref_noscript">les commentaires gérés avec Disqus.</a></noscript>
    <!--<a href="http://disqus.com" class="dsq-brlink">Les commentaires sont hébergés par <span class="logo-disqus">Disqus</span>.</a>-->

<footer>
  <div class="row">
    <div class="col-lg-12">
      <p>Contenus sous licence <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/fr/" rel="nofollow">Creative Commons Attribution - Pas d’utilisation commerciale - Partage dans les mêmes conditions</a>.<br />
      Propulsé par <a href="http://www.r-project.org/" rel="nofollow">R</a>, </a><a href="http://www.rstudio.com/" rel="nofollow">RStudio</a>, <a href="http://rmarkdown.rstudio.com/" rel="nofollow">R Markdown</a>, <a href="http://yihui.name/knitr/" rel="nofollow">knitr</a>, <a href="http://pandoc.org/" rel="nofollow">pandoc</a> et <a href="http://www.princexml.com/" rel="nofollow">Prince XML</a>. Hébergé par <a href="https://github.com/" rel="nofollow">GitHub</a>.</p>
    </div>
  </div>
</footer>



</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>

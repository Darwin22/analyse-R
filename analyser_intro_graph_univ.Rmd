---
title: "Graphiques univariés"
---

```{r options_communes, include=FALSE}
source("options_communes.R")
knitr::opts_chunk$set(fig.path = "images/analyse_graph_univ/")
```

<div class="important">
Ce chapitre est en cours d'écriture.
</div>


Une partie de la réputation du logiciel **R** tient à ses excellentes capacités graphiques, qui ont fait l'objet d'[ouvrages complets](http://www.gradaanwr.net/), et qui permettent d'aboutir à des résultats très avancés, telles que des [cartes isarithmiques](https://dsparks.wordpress.com/2012/07/18/mapping-public-opinion-a-tutorial/). De plus, **R** s'articule de mieux en mieux avec d'autres languages, et en particulier [JavaScript](https://fr.wikipedia.org/wiki/JavaScript), ce qui permet de produire des graphiques interactifs avec **R**.

Ce chapitre présente les fonctions graphiques les plus basiques de **R**, de manière à familiariser le lecteur avec la fonction `plot`{data-pkg="graphics" data-rdoc="plot.default"}, et de manière à montrer comment produire, en une ligne de code ou à peine plus, quelques graphiques très fréquemment utilisés au stade exploratoire d'une analyse de données. Ces fonctions basiques ne produisent pas de graphiques particulièrement élégants ou sophistiqués, mais suffisent largement dans un contexte exploratoire.

## Quelques graphiques de base

Commençons par charger en mémoire le jeu de données `rp99` du _package_ `questionr`{.pkg}, qui contient un extrait du [recensement Insee 1999](http://www.insee.fr/fr/bases-de-donnees/default.asp?page=recensements.htm) pour 301 villes du département du Rhône. Ce jeu de données contient toute une série d'indicateurs socio-démographiques mesurés au niveau de chaque commune, tels que les pourcentages de chaque catégorie socio-professionnelle parmi la population, ou le taux de chômage dans cette population à la date du recensement :

```{r}
# chargement du package
library(questionr)

# chargement du jeu de données
data(rp99)

# inspection des variables
str(rp99)
```

### Visualiser une distribution

Intéressons-nous, pour commencer, au taux de chômage des communes du Rhône, qui varie de 0 % à 23 %. Un taux de chômage de 0 % n'est pas anormal quand certaines communes ont une [population active](https://fr.wikipedia.org/wiki/Population_active) de moins de 100 habitants, comme c'est le cas ici. Malheureusement, un taux de chômage de 23 % n'est pas non plus anormal à cette période.

```{r}
summary(rp99$tx.chom)
```

Ces statistiques descriptives donnent une idée de la <dfn>distribution</dfn> du taux de chômage. D'un point de vue graphique, on sait, depuis le [chapitre sur la statistique univariée](pem_stat_univ.html), comment se représenter cette distribution, en construisant son histogramme avec la fonction `hist`{data-pkg="graphics" data-rodc="hist"} :

<figure>
```{r}
hist(rp99$tx.chom)
```
<figcaption>Histogramme</figcaption>
</figure>

Jusqu'ici, rien de bien compliqué : la fonction `hist`{data-pkg="graphics" data-rodc="hist"} fait tout le travail nécessaire. Toutefois, ce n'est pas la seule manière de procéder avec **R**, qui possède également une fonction générique, `plot`{data-pkg="graphics" data-rdoc="plot.default"}, qui « s'adapte » à ce qu'on lui demande de visualiser. En voici un exemple :

<figure>
```{r}
plot(density(rp99$tx.chom))
```
<figcaption>Courbe de densité</figcaption>
</figure>

Ici, on d'abord construit un objet bien particulier avec la fonction `density`{data-pkg="stats"}, qui permet d'obtenir une <dfn>estimation par noyau</dfn><dfn data-index="noyau, estimation"></dfn>^[Voir <https://fr.wikipedia.org/wiki/Estimation_par_noyau>] de la distribution du taux de chômage. Le résultat de cette estimation est ensuite représenté graphiquement à l'aide de `plot`{data-pkg="stats" data-rdoc="plot.density"}.

De manière similaire, on peut calculer la <dfn>fonction de répartition empirique</dfn><dfn data-index="répartition empirique, fonction"> ou <dfn lang="en">empirical cumulative distribution function</dfn> en anglais avec la fonction `ecdf`{.pkg}. Le résultat obtenu peut, une fois encore, être représenté sur un graphique à l'aide de la fonction `plot`{data-pkg="stats" data-rdoc="ecdf"}.

<figure>
```{r}
plot(ecdf(rp99$tx.chom))
```
<figcaption>Fonction de répartition empirique cumulée</figcaption>
</figure>


### Visualiser un nuages de points

```{r, fig.height = 7, fig.width = 7}
with(rp99, plot(dipl.aucun, tx.chom))
```

```{r, fig.height = 7, fig.width = 7}
# graphique principal
with(rp99, plot(dipl.aucun, tx.chom, cex = pop.tot / 10^4))

# légende justifiée à droite
text(40, 0, "taille des points proportionnelle à la population", adj = c(1, 0))
```

### Visualiser des proportions

```{r}
# recodage du taux de chômage
t = cut(rp99$tx.chom, seq(0, 25, 5), right = FALSE)

# taille des groupes recodés
table(t, exclude = NULL)

# graphique en barres
barplot(table(t))
```

## Quelques graphiques plus complexes

### Matrices de nuages de points

```{r, fig.height = 7, fig.width = 7}
pairs(rp99[, 18:21 ])
```

### Densité d'un nuage de points

```{r, fig.height = 7, fig.width = 7}
smoothScatter(rp99[, c("tx.chom", "dipl.sup") ])
```

### Résultats d'un modèle linéaire

```{r}
# modèle linéaire
m = lm(tx.chom ~ dipl.aucun, data = rp99)

# résumé des résultats
summary(m)
```

```{r, eval = FALSE}
plot(m)
```

```{r}
plot(y = resid(m), x = fitted(m))
```

```{r}
# graphique principal, avec titres
plot(y = resid(m), x = fitted(m),
     col = densCols(resid(m)),
     main = "Taux de chômage ~ Proportion de non-diplômés",
     ylab = "Résidus", xlab = "Valeurs prédites")

# ajout de ligne horizontale
abline(a = 0, b = 0, lty = "dashed")
```

## Exporter un graphique avec **RStudio**

L'<dfn>export de graphiques</dfn><dfn data-index="graphique, export"></dfn> est 
très facile avec **RStudio**. Lorsque l'on
créé un graphique, ce dernier est affiché sous l'onglet *Plots* dans
le quadrant inférieur droit. Il suffit de cliquer sur *Export* pour 
avoir accès à trois options différentes :

* *Save as image* pour sauvegarder le graphique en tant que fichier image ;
* *Save as PDF* pour sauvegarder le graphique dans un fichier **PDF** ;
* *Copy to Clipboard* pour copier le graphique dans le presse-papier (et pouvoir
  ainsi le coller ensuite dans un document **Word** par exemple).
  
### Sauvegarder le fichier en tant qu'image

<figure>
![Sauvegarder un graphique en tant qu'image avec RStudio](images/capture_RStudio_save_plot_as_image.png)
<figcaption>Sauvegarder un graphique en tant qu'image avec RStudio</figcaption>
</figure>

La boîte de dialogue qui s'ouvre propose différentes options d'export :

* le type de fichier désiré ;
* le nom du fichier ;
* le répertoire où le fichier doit être créé (par défaut, il s'agit du répertoire de travail) ;
* la taille de l'image.

**R** peut exporter un graphique dans une grande variété de formats. Nous n'aborderons ici que 
les principaux. Les formats **PNG**, **JPEG** et **TIFF** sont des formats de type 
<dfn langue="en">bitmap</dfn><dfn data-index="image bitmap"></dfn> (on parle aussi 
d'<dfn data-index="image matricielle">images matricielles</dfn>^[Voir
<http://fr.wikipedia.org/wiki/Image_matricielle>.]). 
L'image est stockée sous forme de points, sa qualité dépendant de sa <dfn>résolution</dfn>, c'est-à-dire du 
nombre total de points qui la composent. L'intérêt des images matricielles est d'être toujours
interprétées de manière identique quelque soit l'outil utilisé. Par contre, elles ne sont pas
adaptées lorsque l'on souhaite effectuer des retouches avec un logiciel de dessin.

Pour une utilisation sur un site web, on privilégiera une résolution d'image modérée (entre 400
et 800 pixels de largeur) et les formats **PNG** ou **JPEG**. Pour un document destiné à être
imprimé, on priviligiera une résolution plus élevée, pour éviter un phénomène dit de pixellisation.

Les <dfn data-index="image vectorielle">images vectorielles</dfn>^[Voir
<http://fr.wikipedia.org/wiki/Image_vectorielle>.] ont l'avantage 
de pouvoir être redimensionnées à volonté sans perte de qualité et produisent des fichiers en général 
de plus petite taille^[Sauf dans le cas des graphiques complexes reposant sur des dégradés de couleurs,
comme les cartes produites à partir de rasters. Auquel cas, il sera parfois préférable de privilégier
un export dans un format *bitmap*.]. Elles sont donc tout à fait adaptées pour l'impression.
Si l'on souhaite importer l'image dans **Word**, on choisira le format **Metafile** (le seul
compris par ce logiciel). Pour **Libre Office** ou **Open Office**, on choisira le format **SVG**.

**SVG** (*scalable vector graphic*^[Voir <https://www.wikiwand.com/fr/Scalable_Vector_Graphics>.]) 
est un format libre permettant de décrire une image vectorielle. Les fichiers **SVG** peuvent 
être directement lus par la majorité des navigateurs récents (**Firefox**, **Chrome**, ...).
De plus, le logiciel libre de dessins **Inkscape**^[téléchargeable gratuitement sur <https://inkscape.org/fr/>.]
permet d'éditer et de modifier des fichiers **SVG**. Ce format est donc tout à fait adapté pour les
graphiques que l'on souhaite retoucher avant publication. Depuis **Inkscape**, il sera possible
de faire un export **PNG** en haute résolution pour intégration dans un fichier **Word**.

On pourra modifier la taille de l'image avec les paramètres *Height* (hauteur) et *Width* (largeur).
En cliquant sur *Update Preview* la prévisulation du rendu final sera mise à jour.

### Sauvegarder le graphique en PDF

<figure>
![Sauvegarder un graphique en PDF avec RStudio](images/capture_RStudio_save_plot_as_pdf.png)
<figcaption>Sauvegarder un graphique en PDF avec RStudio</figcaption>
</figure>

Les options de la boîte de dialogue permettent de modifier la taille du fichier **PDF** et,
bien entendu, d'indiquer le nom et le répertoire du fichier à créer.

En cliquant sur *Preview*, **RStudio** générera un fichier temporaire afin de visualiser le
rendu final.

### Copier le graphique dans le presse-papier

<figure>
![Copier un graphique dans le presse-papier avec RStudio](images/capture_RStudio_copy_plot_to_clipboard.png)
<figcaption>Copier un graphique dans le presse-papier avec RStudio</figcaption>
</figure>

Il est possible de redimensionner le graphique. De plus, on précisera si l'on souhaite copier une version
matricielle (*bitmap*) ou vectorielle (*metafile*) du graphique.

## Exporter un graphique avec **R**

On peut également exporter les graphiques dans des fichiers de différents formats directement avec
des commandes **R**. Ceci a l'avantage de fonctionner sur toutes les plateformes et de faciliter la mise à
jour du graphique exporté (on n'a qu'à relancer les commandes concernées pour que le fichier externe soit
mis à jour).

La première possibilité est d'exporter le contenu d'une fenêtre déjà existante à l'aide de la fonction
`dev.print`{data-package="grDevices" data-rdocumentation="dev2"}. On doit fournir à celle-ci le format de 
l'export (option `device`) et le nom du fichier (option `file`).

Par exemple :

```{r, eval=FALSE}
boxplot(rnorm(100))
dev.print(device = png, file = "export.png", width = 600)
```

Les formats de sortie possibles varient selon les plateformes, mais on retrouve partout les formats
*bitmap* `png`, `jpeg`, `tiff` et les formats vectoriels `svg`, `postscript` ou `pdf`. 

L'autre possibilité est de rediriger directement la sortie graphique dans un fichier, avant d'exécuter
la commande générant la figure. On doit pour cela faire appel à l'une des commandes permettant cette
redirection. Les plus courantes sont `png`{data-package="grDevices"}, 
`jpeg`{data-package="grDevices" data-rdocumentation="png"} et
`tiff`{data-package="grDevices" data-rdocumentation="png"} pour les formats *bitmap*, 
`svg`{data-package="grDevices" data-rdocumentation="cairo"},
`pdf`{data-package="grDevices"}, `postscript`{data-package="grDevices"} et
`win.metafile`{data-package="grDevices" data-rdocumentation="windows"} pour les formats vectoriels.

Ces fonctions prennent différentes options permettant de personnaliser la sortie graphique. Les plus
courantes sont `width` et `height` qui donnent la largeur et la hauteur de l'image générée (en pixels pour
les images bitmap, en pouces pour les images vectorielles) et `pointsize` qui donne la taille de base des
polices de caractère utilisées.


```{r, eval=FALSE}
png(file = "out.png", width = 800, height = 700)
plot(rnorm(100))
dev.off()
pdf(file = "out.pdf", width = 9, height = 9, pointsize = 10)
plot(rnorm(150))
dev.off()
```

Il est nécessaire de faire un appel à la fonction `dev.off`{data-package="grDevices" data-rdocumentation="dev"} 
après génération du graphique pour que le résultat soit bien écrit dans le fichier de sortie 
(dans le cas contraire on se retrouve avec un fichier vide).


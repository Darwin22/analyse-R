<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Fusion de tables</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<meta name="robots" content="index, follow">
<link rel="stylesheet" href="./include/analyse-R.css" />
<script type="text/javascript" src="./libs/zeroclipboard-2.2.0/ZeroClipboard.js"></script>
<link rel="stylesheet" href="./libs/colorbox-1.6.1/colorbox.css" />
<script type="text/javascript" src="./libs/colorbox-1.6.1/jquery.colorbox-min.js"></script>
<!--- favicon --->
<link rel="apple-touch-icon" sizes="57x57" href="./images/favicon/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="./images/favicon/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="./images/favicon/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="./images/favicon/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="./images/favicon/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="./images/favicon/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="./images/favicon/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="./images/favicon/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="./images/favicon/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="./images/favicon/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="./images/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="./images/favicon/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="./images/favicon/favicon-16x16.png">
<link rel="manifest" href="./images/favicon/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="./images/favicon/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->





<nav>
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href=".">analyse-R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="manipuler" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Manipuler <span class="caret"></span></a>
          <ul class="dropdown-menu multi-column columns-3" role="menu" id="menu_manipuler">
            <div class="row">
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Prise en main</li>
                  <li><a href="presentation-et-philosophie.html">Présentation et Philosophie</a></li>
                  <li><a href="installation-de-R-et-RStudio.html">Installation de R et RStudio</a></li>
                  <li><a href="premier-contact.html">Premier contact</a></li>
                  <li><a href="premier-travail-avec-les-donnees.html">Premier travail avec des données</a></li>
                  <li><a href="extensions.html">Extensions</a></li>
                  <li><a href="vecteurs-indexation-et-assignation.html">Vecteurs, indexation et assignation</a></li>
                  <li><a href="listes-et-tableaux-de-donnes.html">Listes et Tableaux de données</a></li>
                  <li><a href="facteurs-et-vecteurs-labellises.html">Facteurs et vecteurs labellisés</a></li>
                  <li><a href="organiser-ses-fichiers.html">Organiser ses fichiers</a></li>
                  <li><a href="import-de-donnees.html">Import de données</a></li>
                  <li><a href="recodage.html">Recodage</a></li>
                  <li><a href="ou-trouver-de-l-aide.html">Où trouver de l'aide ?</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Manipulation de données</li>
  		            <li><a href="visualiser-ses-donnees.html">Visualiser ses données</a></li>
                  <li><a href="introduction-a-dplyr.html">Introduction à dplyr</a></li>
                  <li><a href="introduction-a-data-table.html">Introduction à data.table</a></li>
                  <li class="dev"><a href="doublons.html">Doublons</a></li>
                  <li><a href="tris.html">Tris</a></li>
                  <li><a href="sous-ensembles.html">Sous-ensembles</a></li>
                  <li><a href="fusion-de-tables.html">Fusion de tables</a></li>
                  <li class="dev"><a href="gestion-des-dates.html">Gestion des dates</a></li>
                  <li class="dev"><a href="agregation.html">Agrégation</a></li>
                  <li class="dev"><a href="fonctions-a-fenetre.html">Fonctions à fenêtre</a></li>
                  <li class="dev"><a href="restructuration-de-donnees.html">Restructuration de données</a></li>
                  <li class="dev"><a href="manipuler-du-texte.html">Manipuler du texte</a></li>
                  <li><a href="scraping.html">Scraping</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
                  <li class="dropdown-header">Exporter</li>
                  <li class="dev"><a href="export-de-donnees.html">Export de données</a></li>
                  <li><a href="export-de-graphiques.html">Export de graphiques</a></li>
                  <li class="dev"><a href="export-de-tableaux.html">Export de tableaux</a></li>
  	            </ul>
              </div>
            </div>
          </ul>
        </li>
        <li class="dropdown">
          <a href="analyser" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Analyser <span class="caret"></span></a>
          <ul class="dropdown-menu multi-column columns-3" role="menu" id="menu_analyser">
            <div class="row">
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Statistiques introductives</li>
                  <li><a href="statistique-univariee.html">Statistique univariée</a></li>
                  <li><a href="statistique-bivariee.html">Statistique bivariée</a></li>
                  <li><a href="intro-ggplot2.html">Introduction à ggplot2</a></li>
                  <li><a href="graphiques-bivaries-ggplot2.html">Graphiques univariés et bivariés avec ggplot2</a></li>
                  <li><a href="donnees-ponderees.html">Données pondérées</a></li>
                  <li class="dev"><a href="graphiques-de-donnees-ponderees.html">Graphiques de données pondérées</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Statistiques intermédiaires</li>
  		            <li><a href="intervalles-de-confiance.html">Intervalles de confiance</a></li>
                  <li><a href="comparaisons-moyennes-et-proportions.html">Comparaisons (moyennes et proportions)</a></li>
                  <li><a href="definir-un-plan-d-echantillonnage-complexe.html">Définir un plan d'échantillonnage complexe</a></li>
                  <li class="dev"><a href="regression-lineaire.html">Régression linéaire</a></li>
                  <li><a href="regression-logistique.html">Régression logistique binaire, multinomiale et ordinale</a></li>
                  <li><a href="analyse-des-correspondances-multiples.html">Analyse des correspondances multiples (ACM)</a></li>
                  <li><a href="classification-ascendante-hierarchique.html">Classification ascendante hiérarchique (CAH)</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
                  <li class="dropdown-header">Statistiques avancées</li>
                  <li class="dev"><a href="modeles-lineaires-a-effets-mixtes.html">Modèles linéaires à effets mixtes</a></li>
                  <li class="dev"><a href="modeles-gee.html">Modèles GEE</a></li>
                  <li class="dev"><a href="series-temporelles.html">Séries temporelles</a></li>
                  <li class="dev"><a href="modeles-a-temps-discret.html">Modèles à temps discret</a></li>
                  <li><a href="analyse-de-survie.html">Analyse de survie</a></li>
                  <li><a href="analyse-de-sequences.html">Analyse de séquences</a></li>
                  <li class="dev"><a href="analyse-de-reseaux.html">Analyse de réseaux</a></li>
                  <li class="dev"><a href="analyse-spatiale.html">Analyse spatiale</a></li>
  	            </ul>
              </div>
            </div>
          </ul>
        </li>
        <li class="dropdown">
          <a href="approfondir" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Approfondir <span class="caret"></span></a>
          <ul class="dropdown-menu multi-column columns-3" role="menu" id="menu_approfondir">
            <div class="row">
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Graphiques</li>
                  <li class="dev"><a href="ggplot2-la-grammaire-des-graphiques.html">ggplot2 : la grammaire des graphiques</a></li>
                  <li class="dev"><a href="etendre-ggplot2.html">Étendre ggplot2</a></li>
                  <li class="dev"><a href="lattice-graphiques-et-formules.html">lattice : graphiques et formules</a></li>
                  <li class="dev"><a href="diagrammes.html">Diagrammes</a></li>
                  <li class="dev"><a href="representer-des-flux.html">Représenter des flux</a></li>
                  <li class="dev"><a href="reseaux-dynamiques.html">Réseaux dynamiques</a></li>
                  <li class="dev"><a href="ggvis-les-graphiques-interactifs.html">ggvis : les graphiques interactifs</a></li>
                  <li class="dev"><a href="htmlwidgets-la-puissance-du-javascript.html">htmlwidgets : la puissance de javascript</a></li>
                  <li class="dev"><a href="cartes.html">Cartes</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Programmation</li>
  		            <li><a href="conditions-et-comparaisons.html">Conditions et comparaisons</a></li>
                  <li><a href="formules.html">Formules</a></li>
                  <li class="dev"><a href="structures-conditionnelles.html">Structures conditionnelles</a></li>
                  <li class="dev"><a href="expressions-regulieres.html">Expressions régulières</a></li>
                  <li class="dev"><a href="ecrire-ses-propres-fonctions.html">Écrire ses propres fonctions</a></li>
                  <li class="dev"><a href="rmarkdown-les-rapports-automatises.html">R Markdown : les rapports automatisés</a></li>
                  <li class="dev"><a href="shiny-les-interfaces-interactives.html">Shiny : les interfaces interactives</a></li>
                  <li class="dev"><a href="git.html">Git</a></li>
                  <li class="dev"><a href="developper-un-package.html">Développer un package</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
                  <li class="dropdown-header">Divers</li>
                  <li><a href="calculer-un-age.html">Calculer un âge</a></li>
                  <li class="dev"><a href="diagramme-de-lexis.html">Diagramme de Lexis</a></li>
  	            </ul>
              </div>
            </div>
          </ul>
        </li>
        <li class="dropdown">
          <a href="index" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Index <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="menu_naviguer">
            <li><a href="index-des-concepts.html">Index des concepts</a></li>
            <li><a href="index-des-fonctions.html">Index des fonctions</a></li>
            <li><a href="index-des-extensions.html">Index des extensions</a></li>
          </ul>
        </li>
        <li><a href="analyse-R.pdf">PDF</a></li>
      </ul>
    <form id="rechercher" class="navbar-form navbar-right" role="search" style="padding-top: 5px;" method="get" action="https://tontonroger.org/">
      <div class="form-group">
        <input name="q" type="text" class="form-control input-sm" placeholder="Rechercher">
      </div>
      <button type="submit" class="btn btn-default btn-sm" name="Rechercher">
        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
      </button>
    </form>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
</nav>

<div class="row">

<a href="https://github.com/larmarange/analyse-R"><img style="position: absolute; top: 60px; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Contribuer sur GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

<div class="col-sm-9" role="main">
<article>

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Fusion de tables</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#la-fonction-merge">La fonction merge</a></li>
<li><a href="#extension-dplyr">Extension dplyr</a></li>
<li><a href="#extension-data.table">Extension data.table</a></li>
</ul>
</div>

<p>Lorsqu’on traite de grosses enquêtes, notamment les enquêtes de l’INSEE, on a souvent à gérer des données réparties dans plusieurs tables, soit du fait de la construction du questionnaire, soit du fait de contraintes techniques (fichiers <strong>dbf</strong> ou <strong>Excel</strong> limités à 256 colonnes, par exemple).</p>
<p>Cela arrive également lorsque l’on traitre de données d’une enquêtes réalisée à différents niveaux (par exemple, un questionnaire ménage et un questionnaire individu).</p>
<div id="la-fonction-merge" class="section level1">
<h1>La fonction merge</h1>
<p>Une opération relativement courante consiste à <dfn data-index="fusion de tables">fusionner</dfn><dfn data-index="tableau de données, fusion"></dfn> plusieurs tables pour regrouper tout ou partie des données dans un unique tableau.</p>
<p>Nous allons simuler artificiellement une telle situation en créant deux tables à partir de l’extrait de l’enquête <em>Histoire de vie</em> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(questionr)
<span class="kw">data</span>(hdv2003)
d &lt;-<span class="st"> </span>hdv2003
<span class="kw">dim</span>(d)</code></pre></div>
<pre><code>[1] 2000   20</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d1 &lt;-<span class="st"> </span><span class="kw">subset</span>(d, <span class="dt">select =</span> <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;sexe&quot;</span>))
<span class="kw">dim</span>(d1)</code></pre></div>
<pre><code>[1] 2000    3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d2 &lt;-<span class="st"> </span><span class="kw">subset</span>(d, <span class="dt">select =</span> <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;clso&quot;</span>))
<span class="kw">dim</span>(d2)</code></pre></div>
<pre><code>[1] 2000    2</code></pre>
<p>On a donc deux tableaux de données, <code>d1</code> et <code>d2</code>, comportant chacun 2000 lignes et respectivement 3 et 2 colonnes. Comment les rassembler pour n’en former qu’un ?</p>
<p>Intuitivement, cela paraît simple. Il suffit de « coller » <code>d2</code> à la droite de <code>d1</code>, comme dans l’exemple suivant.</p>
<style type="text/css">
table.exemple_df td, 
table.exemple_df th {
  text-align: center;
  padding: 3px 10px;
}
table.exemple_df th {
  border-bottom: solid 1px #999;
}

table.exemple_df td + td,
table.exemple_df th + th {
  border-left: solid 1px #999;
}

table.exemple_operateur td {
  font-size: 3em;
  padding: 20px;
}
</style>
<table style="margin: 11px auto;">
<tr>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
12
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
<td>
17
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
<td>
41
</td>
</tr>
<tr>
<td>
4
</td>
<td>
F
</td>
<td>
9
</td>
</tr>
<tr>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
+
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v3
</th>
</tr>
<tr>
<td>
1
</td>
<td>
rouge
</td>
</tr>
<tr>
<td>
2
</td>
<td>
bleu
</td>
</tr>
<tr>
<td>
3
</td>
<td>
bleu
</td>
</tr>
<tr>
<td>
4
</td>
<td>
rouge
</td>
</tr>
<tr>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
=
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
<th>
v2
</th>
<th>
v3
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
12
</td>
<td>
rouge
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
<td>
17
</td>
<td>
bleu
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
<td>
41
</td>
<td>
bleu
</td>
</tr>
<tr>
<td>
4
</td>
<td>
F
</td>
<td>
9
</td>
<td>
rouge
</td>
</tr>
<tr>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
</table>
</td>
</tr>
</table>
<p>Cela semble fonctionner. La fonction qui permet d’effectuer cette opération sous <strong>R</strong> s’appelle <code data-pkg="base">cbind</code>, elle « colle » des tableaux côte à côte en regroupant leurs colonnes<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">cbind</span>(d1, d2))</code></pre></div>
<pre><code>  id age  sexe id clso
1  1  28 Femme  1  Oui
2  2  23 Femme  2  Oui
3  3  59 Homme  3  Non
4  4  34 Homme  4  Non
5  5  71 Femme  5  Oui
6  6  35 Femme  6  Non</code></pre>
<p>À part le fait qu’on a une colonne <em>id</em> en double, le résultat semble satisfaisant. À première vue seulement. Imaginons maintenant que nous avons travaillé sur <code>d1</code> et <code>d2</code>, et que nous avons ordonné les lignes de <code>d1</code> selon l’âge des enquêtés :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d1 &lt;-<span class="st"> </span>d1[<span class="kw">order</span>(d1<span class="op">$</span>age), ]</code></pre></div>
<p>Répétons l’opération de collage :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">cbind</span>(d1, d2))</code></pre></div>
<pre><code>     id age  sexe id clso
162 162  18 Homme  1  Oui
215 215  18 Homme  2  Oui
346 346  18 Femme  3  Non
377 377  18 Homme  4  Non
511 511  18 Homme  5  Oui
646 646  18 Homme  6  Non</code></pre>
<p>Que constate-t-on ? La présence de la variable <em>id</em> en double nous permet de voir que les identifiants ne coïncident plus ! En regroupant nos colonnes nous avons donc attribué à des individus les réponses d’autres individus.</p>
<p>La commande <code data-pkg="base">cbind</code> ne peut en effet fonctionner que si les deux tableaux ont exactement le même nombre de lignes, et dans le même ordre, ce qui n’est pas le cas ici.</p>
<p>On va donc être obligé de pocéder à une <dfn>fusion</dfn> des deux tableaux, qui va permettre de rendre à chaque ligne ce qui lui appartient. Pour cela nous avons besoin d’un identifiant qui permet d’identifier chaque ligne de manière unique et qui doit être présent dans tous les tableaux. Dans notre cas, c’est plutôt rapide, il s’agit de la variable <em>id</em>.</p>
<p>Une fois l’identifiant identifié<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>, on peut utiliser la commande <code data-pkg="base">merge</code>. Celle-ci va fusionner les deux tableaux en supprimant les colonnes en double et en regroupant les lignes selon leurs identifiants :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d.complet &lt;-<span class="st"> </span><span class="kw">merge</span>(d1, d2, <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>)
<span class="kw">head</span>(d.complet)</code></pre></div>
<pre><code>  id age  sexe clso
1  1  28 Femme  Oui
2  2  23 Femme  Oui
3  3  59 Homme  Non
4  4  34 Homme  Non
5  5  71 Femme  Oui
6  6  35 Femme  Non</code></pre>
<p>Ici l’utilisation de la fonction <code data-pkg="base">merge</code> est plutôt simple car nous sommes dans le cas de figure idéal : les lignes correspondent parfaitement et l’identifiant est clairement identifié. Parfois les choses peuvent être un peu plus compliquées :</p>
<ul>
<li>parfois les identifiants n’ont pas le même nom dans les deux tableaux. On peut alors les spécifier par les options <code>by.x</code> et <code>by.y</code> ;</li>
<li>parfois les deux tableaux comportent des colonnes (hors identifiants) ayant le même nom. <code data-pkg="base">merge</code> conserve dans ce cas ces deux colonnes mais les renomme en les suffixant par <em>.x</em> pour celles provenant du premier tableau et <em>.y</em> pour celles du second ;</li>
<li>parfois on n’a pas d’identifiant unique préétabli, mais on en construit un à partir de plusieurs variables. On peut alors donner un vecteur en paramètres de l’option <code>by</code>, par exemple <code>by=c(&quot;nom&quot;,&quot;prenom&quot;,&quot;date.naissance&quot;)</code>.</li>
</ul>
<p>Une subtilité supplémentaire intervient lorsque les deux tableaux fusionnés n’ont pas exactement les mêmes lignes. Par défaut, <code data-pkg="base">merge</code> ne conserve que les lignes présentes dans les deux tableaux :</p>
<table style="margin: 11px auto;">
<tr>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
+
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
15
</td>
</tr>
<tr>
<td>
5
</td>
<td>
31
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
=
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
<td>
15
</td>
</tr>
</table>
</td>
</tr>
</table>
<p>On peut cependant modifier ce comportement avec les options <code>all.x</code> et <code>all.y</code>.</p>
<p>Ainsi, <code>all.x=TRUE</code> indique de conserver toutes les lignes du premier tableau. Dans ce cas <code data-pkg="base">merge</code> donne une valeur <code>NA</code> pour ces lignes aux colonnes provenant du second tableau. Ce qui donnerait :</p>
<table style="margin: 11px auto;">
<tr>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
+
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
15
</td>
</tr>
<tr>
<td>
5
</td>
<td>
31
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
=
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
<td>
15
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
<td>
<code>NA</code>
</td>
</tr>
</table>
</td>
</tr>
</table>
<p>L’option <code>all.y=TRUE</code> fait la même chose en conservant toutes les lignes du second tableau.</p>
<table style="margin: 11px auto;">
<tr>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
+
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
15
</td>
</tr>
<tr>
<td>
5
</td>
<td>
31
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
=
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
<td>
15
</td>
</tr>
<tr>
<td>
5
</td>
<td>
<code>NA</code>
</td>
<td>
31
</td>
</tr>
</table>
</td>
</tr>
</table>
<p>Enfin, on peut décider de conserver toutes les lignes des deux tableaux en utilisant à la fois <code>all.x=TRUE</code> et <code>all.y=TRUE</code>, ce qui donne :</p>
<table style="margin: 11px auto;">
<tr>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
+
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
15
</td>
</tr>
<tr>
<td>
5
</td>
<td>
31
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
=
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
<td>
15
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
<td>
<code>NA</code>
</td>
</tr>
<tr>
<td>
5
</td>
<td>
<code>NA</code>
</td>
<td>
31
</td>
</tr>
</table>
</td>
</tr>
</table>
<p>Parfois, l’un des identifiants est présent à plusieurs reprises dans l’un des tableaux (par exemple lorsque l’une des tables est un ensemble de ménages et que l’autre décrit l’ensemble des individus de ces ménages). Dans ce cas les lignes de l’autre table sont dupliquées autant de fois que nécessaires :</p>
<table style="margin: 11px auto;">
<tr>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
+
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
10
</td>
</tr>
<tr>
<td>
1
</td>
<td>
18
</td>
</tr>
<tr>
<td>
1
</td>
<td>
21
</td>
</tr>
<tr>
<td>
2
</td>
<td>
15
</td>
</tr>
<tr>
<td>
3
</td>
<td>
42
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
=
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
10
</td>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
18
</td>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
21
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
<td>
15
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
<td>
42
</td>
</tr>
</table>
</td>
</tr>
</table>
</div>
<div id="extension-dplyr" class="section level1">
<h1>Extension dplyr</h1>
<p>Voir la vignette dédiée (en anglais) : <a href="https://cran.rstudio.com/web/packages/dplyr/vignettes/two-table.html" class="uri">https://cran.rstudio.com/web/packages/dplyr/vignettes/two-table.html</a>.</p>
<p>Les principales fonctions de <code class="pkg">dplyr</code> pour la fusion de tables sont <code data-pkg="dplyr" data-rdoc="join">inner_join</code> et <code data-pkg="dplyr" data-rdoc="join">left_join</code>.</p>
</div>
<div id="extension-data.table" class="section level1">
<h1>Extension data.table</h1>
<p><code class="pkg">data.table</code> fourni une fonction <code data-pkg="data.table">merge</code> beaucoup plus rapide que celle standard de R mais fonctionnant de manière identique.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>L’équivalent de <code data-pkg="base">cbind</code> pour les lignes s’appelle <code data-pkg="base" data-rdoc="cbind">rbind</code>.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Si vous me passez l’expression…<a href="#fnref2">↩</a></p></li>
</ol>
</div>

</article>
</div>

<div class="col-sm-3" role="complementary">
<nav class="hidden-print hidden-xs" id="nav_sidebar">
</nav>
</div>

</div>

<script>
// manage active state of menu based on current page
$(document).ready(function () {

    // active menu
    href = window.location.pathname;
    href = href.substr(href.lastIndexOf('/') + 1);
    if (href=='') href = 'index.html';
    $('a[href="' + href + '"]').parent().addClass('active');
    $('a[href="' + href + '"]').parent().parents('li').addClass('active');

    // élargir la page d'accueil
    if (href=='index.html') $('.col-sm-9').attr('class','col-sm-12');

    // rechercher
    $("#rechercher").submit(function(event) {
      $('input[name="q"]').val($('input[name="q"]').val() + ' site:larmarange.github.io/analyse-R');
    });

    // sidebar
    $("#nav_sidebar").append($("#TOC").html());
    $("#nav_sidebar ul").addClass("nav nav-stacked");
    $("#TOC").addClass("visible-xs-block");
    $('body').scrollspy({
      target: '#nav_sidebar',
      offset: 40
    });

    // Identifier les <pre> fermant
    $('pre').next("*:not(pre)").prev().addClass('last'); // Dernier <pre> de chaque groupe contigu de <pre>
    $('pre').parent().each(function (){
      $(this).children('pre').last().addClass('last');
    }); // Si <pre> est le dernier enfant de son parent

    // Ajout liens rdocumentation et tooltip
    $("code[data-pkg]").each(function( index ) {
      pkg = $(this).attr('data-pkg');
      if ($(this).attr('data-rdoc') !== undefined) {
        rdocumentation = $(this).attr('data-rdoc');
      } else {
        rdocumentation = $(this).text();
      }
      fonction = $(this).text();
      $(this).wrap('<a href="http://www.rdocumentation.org/packages/'+pkg+'/functions/'+rdocumentation+'">');
      $(this).attr('data-toggle','tooltip');
      $(this).attr('data-placement','top');
      $(this).attr('title','package : ' + pkg);
      $('[data-toggle="tooltip"]').tooltip();
    });

    $("code.pkg").each(function( index ) {
      $(this).wrap('<a href="http://www.rdocumentation.org/packages/'+$(this).text()+'">');
    });

    // Figures
    $("figure").each(function( index ) {
      if ($(this).children("figcaption").length > 0)
        $(this).children("figcaption:first").prepend('<span class="figure-number">Figure '+(index+1)+'.</span> ');
      else
        $(this).append($("<figcaption>").append('<span class="figure-number">Figure '+(index+1)+'</span>'));
    });

    // Colorbox
    jQuery('article div img').colorbox({
      maxWidth: '90%',
      maxHeight: '90%',
      rel: 'figures',
      current: "",
      href: function(){
        return $(this).attr('src');
      },
      title: function(){
        return $(this).attr('alt');
      }
    });
    jQuery('article div img').css('cursor', 'pointer');
    jQuery('figure img').colorbox({
      maxWidth: '90%',
      maxHeight: '90%',
      rel: 'figures',
      current: "",
      href: function(){
        return $(this).attr('src');
      },
      title: function(){
        return $(this).parent().children("figcaption").text();
      }
    });
    jQuery('figure img').css('cursor', 'pointer');

    // ZeroClipboard
    $('pre.r').parent().each(function(){
      $(this).children('pre.r').first().before('<div class="zero-clipboard hidden-print hidden-xs"><button class="btn-clipboard">Copier</button></div>');
    }); // Il peut arriver que le pre ne soit pas précédé (cf. figures)
    $('*:not(pre):not(.zero-clipboard) + pre.r').before('<div class="zero-clipboard hidden-print hidden-xs"><button class="btn-clipboard">Copier</button></div>');
    $('pre.last').after(function() {
      if ($(this).hasClass("r")) res = $(this).text(); else res = "";
      $(this).prevUntil('*:not(pre)','pre.r').each(function() {
        res = $(this).text() + '\n' + res;
      });
      return '<div class="clipboard">' + res + '</div>';
    });
    $('.zero-clipboard').each(function(index){
      $(this).children('.btn-clipboard').attr('data-clipboard-target','clipboard_'+index);
      $(this).nextAll("div.clipboard").first().attr('id','clipboard_'+index);
    });
    var client = new ZeroClipboard( $(".btn-clipboard") );
    client.on( "ready", function( readyEvent ) {
      // alert( "ZeroClipboard SWF is ready!" );
      client.on( "aftercopy", function( event ) {
        // `this` === `client`
        // `event.target` === the element that was clicked
        //event.target.style.display = "none";
        $(event.target).parent().before('<div class="alert alert-success"><a href="#" class="close" data-dismiss="alert">&times;</a>Le code <strong>R</strong> de l’exemple a été copié dans le presse-papier.</div>');
      } );
    } );

});
</script>

<!-- disqus -->
<div class="row">
  <div id="disqus_thread" class="col-sm-9" role="complementary"></div>
</div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'analyse-r'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Veuillez activer JavaScript pour voir les <a href="http://disqus.com/?ref_noscript">les commentaires gérés avec Disqus.</a></noscript>
    <!--<a href="http://disqus.com" class="dsq-brlink">Les commentaires sont hébergés par <span class="logo-disqus">Disqus</span>.</a>-->

<footer>
  <div class="row">
    <div class="col-lg-12">
      <p>Contenus sous licence <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/fr/" rel="nofollow">Creative Commons Attribution - Pas d’utilisation commerciale - Partage dans les mêmes conditions</a>.<br />
      Propulsé par <a href="http://www.r-project.org/" rel="nofollow">R</a>, </a><a href="http://www.rstudio.com/" rel="nofollow">RStudio</a>, <a href="http://rmarkdown.rstudio.com/" rel="nofollow">R Markdown</a>, <a href="http://yihui.name/knitr/" rel="nofollow">knitr</a>, <a href="http://pandoc.org/" rel="nofollow">pandoc</a> et <a href="http://www.princexml.com/" rel="nofollow">Prince XML</a>. Hébergé par <a href="https://github.com/" rel="nofollow">GitHub</a>.</p>
    </div>
  </div>
</footer>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>


</body>
</html>
